---

- name: ks-devops | Getting devops installation charts
  copy:
    src: "files"
    dest: "{{ kubesphere_dir }}"

- name: ks-devops | Upgrading or installing ks-devops
  shell: |
    {{ bin_dir }}/helm upgrade --install ks-devops-ctl {{ kubesphere_dir }}/charts/ks-devops \
    -n kubesphere-devops-system \
    --create-namespace \
    --set serviceAccount.create=true \
    --set image.pullPolicy=Always \
    --set jenkins.ksAuth.enabled=true

- name: ks-devops | Upgrading or installing ks-devops-plugin
  shell: |
    {{ bin_dir }}/helm upgrade --install ks-devops-plugin {{ kubesphere_dir }}/charts/ks-devops-plugin \
    -n kubesphere-devops-system \
    --create-namespace \
    --set serviceAccount.create=true \
    --set image.pullPolicy=Always
