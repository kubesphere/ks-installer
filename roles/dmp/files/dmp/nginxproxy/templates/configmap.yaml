apiVersion: v1
data:
  nginx.conf: |-
    user www-data;
    worker_processes auto;
    pid /run/nginx.pid;

    events {
            worker_connections 768;
    }

    http {
            sendfile on;
            tcp_nopush on;
            tcp_nodelay on;
            keepalive_timeout 65;
            types_hash_max_size 2048;

            default_type application/octet-stream;

            ssl_certificate /etc/nginx/ssl/tls.crt;
            ssl_certificate_key /etc/nginx/ssl/tls.key;
            ssl_prefer_server_ciphers on;

            upstream oos_server {
                    server minio.kubesphere-system:9000;
            }

            server {
                    listen 80;
                    location / {
                            proxy_pass http://oos_server;
                            proxy_set_header Host $http_host;
                            proxy_set_header X-Real-IP $remote_addr;
                            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                    }
            }

            server {
                    listen 443 ssl;
                    location / {
                            proxy_pass http://oos_server;
                            proxy_set_header Host $http_host;
                            proxy_set_header X-Real-IP $remote_addr;
                            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                    }
            }

            client_max_body_size 100m;


            access_log /var/log/nginx/access.log;
            error_log /var/log/nginx/error.log;

            gzip on;
    }
kind: ConfigMap
metadata:
  name: nginx-conf
  namespace: dmp-system
